var b8r=function(){"use strict";const e={},t={};function n(e){const[,t,,n,r]=e.match(/^(.*?)(([.[])(.*))?$/);return[t,"["===n?"["+r:r]}function r(e){if(!e||"/"===e)return[];if(Array.isArray(e))return e;{const n=[];for(;e.length;){var t=e.search(/\[[^\]]+\]/);if(-1===t){n.push(e.split("."));break}{const r=e.substr(0,t);e=e.substr(t),r&&n.push(r.split(".")),t=e.indexOf("]")+1,n.push(e.substr(1,t-2)),"."===e.substr(t,1)&&(t+=1),e=e.substr(t)}}return n}}function o(e,t){if(!e._b8r_value_maps){const t={};Object.defineProperty(e,"_b8r_value_maps",{get:()=>t})}const n={};return e.forEach((e,r)=>{n[d(e,t)+""]=r}),e._b8r_value_maps[t]=n,n}function s(e,t,n){let r=function(e,t){return e._b8r_value_maps&&e._b8r_value_maps[t]?e._b8r_value_maps[t]:o(e,t)}(e,t)[n];return void 0!==r&&d(e[r],t)+""==n+""||(r=o(e,t)[n]),r}function a(e,t,n){return e[t]||(e[t]=n),e[t]}function i(n,r,o,a){let i=r?s(n,r,o):o;if(a===e)return r?n.splice(i,1):delete n[i],null;if(a===t)r||n[i]||(n[i]={});else if(a)if(void 0!==i)n[i]=a;else{if(!r||d(a,r)+""!=o+"")throw new Error(`byKeyPath insert failed at [${r}=${o}]`);n.push(a),i=n.length-1}return n[i]}function c(e){if(!Array.isArray(e))throw console.error("setByPath failed: expected array, found",e),new Error("setByPath failed: expected array")}function l(e){if(!e||e.constructor!==Object)throw console.error("setByPath failed: expected Object, found",e),new Error("setByPath failed: expected object")}function d(e,t){const n=r(t);var o,s,a,c,l=e;for(o=0,s=n.length;l&&o<s;o++){var d=n[o];if(Array.isArray(d))for(a=0,c=d.length;l&&a<c;a++){l=l[d[a]]}else if(l.length)if(d.indexOf("=")>-1){const[e,...t]=d.split("=");l=i(l,e,t.join("="))}else l=l[a=parseInt(d,10)];else l="="===d[0]?l[d.substr(1)]:void 0}return void 0===l?null:l}function u(n,o,s){let d=n;const u=r(o);for(;d&&u.length;){const n=u.shift();if("string"==typeof n){const r=n.indexOf("=");if(r>-1){if(0===r?l(d):c(d),d=i(d,n.substr(0,r),n.substr(r+1),u.length?t:s),!u.length)return!0}else{c(d);const t=parseInt(n,10);if(!u.length)return s!==e?d[t]=s:d.splice(t,1),!0;d=d[t]}}else{if(!Array.isArray(n)||!n.length)throw console.error("setByPath failed: bad path",o),new Error("setByPath failed");for(l(d);n.length;){const t=n.shift();if(!n.length&&!u.length)return s!==e?d[t]=s:delete d[t],!0;d=a(d,t,n.length?{}:[])}}}throw console.error(`setByPath failed: "${o}" not found in`,n),new Error(`setByPath(${n}, ${o}, ${s}) failed`)}const h=e=>[...e],p=(e,t)=>{const n=Object.keys(e);for(const r of n)if(!1===t(e[r],r))break},f=e=>{if("object"!=typeof e||null===e)return e;const t={};return p(e,(e,n)=>{t[n]=f(e)}),t},m=(e,t)=>{const n=Object.keys(e);for(const r of n)if(t(e[r],r))return r;return null},y=(e,t)=>(p(t,(t,n)=>{"function"!=typeof t&&(t&&t.constructor===Object?e[n]=y({},t):e[n]=t)}),e);var g=Object.freeze({makeArray:h,last:e=>e.length?e[e.length-1]:null,forEach:(e,t)=>{for(let n=0;n<e.length&&!1!==t(e[n],n);n++);},forEachKey:p,deepClone:f,mapKeys:(e,t)=>{const n=Object.keys(e),r=[];for(const o of n)r.push(t(e[o],o));return r},mapEachKey:(e,t)=>{const n=Object.keys(e),r={};for(const o of n)r[o]=t(e[o],o);return r},findKey:m,findValue:(e,t)=>{const n=m(e,t);return n?e[n]:null},filterInPlace:(e,t)=>{for(let n=e.length-1;n>=0;n--)t(e[n],n)||e.splice(n,1)},filterKeys:(e,t)=>{const n=Object.keys(e),r=[];for(const o of n)t(e[o],o)&&r.push(o);return r},filterObject:(e,t)=>{const n=Object.keys(e),r={};for(const o of n)t(e[o],o)&&(r[o]=e[o]);return r},filterObjectInPlace:(e,t)=>{const n=Object.keys(e);for(const r of n)t(e[r],r)||delete e[r]},assignValues:y});const b=(e,t)=>e&&"none"!==getComputedStyle(e).display&&(!t||e===document.body||b(e.parentElement,!0)),v=(e,t)=>!(e.top>t.top+t.height||e.top+e.height<t.top||e.left>t.left+t.width||e.left+e.width<t.left),w=e=>h(document.querySelectorAll(e)),E=document.querySelector.bind(document),O=(e,t,n)=>{const r=h(e.querySelectorAll(t));return n&&e.matches(t)&&r.unshift(e),r},$=(e,t)=>{for(;e.nextElementSibling&&!e.nextElementSibling.matches(t);)e=e.nextElementSibling;return e.nextElementSibling},_=document.getElementById.bind(document),x=document.createTextNode.bind(document),j=document.createDocumentFragment.bind(document),A=document.createElement.bind(document);var C=Object.freeze({isVisible:b,isInView:(e,t)=>{if(!e||!b(e,!0))return!1;const n=e.getBoundingClientRect(),r=t?t.getBoundingClientRect():{left:0,top:0,width:window.innerWidth,height:window.innerHeight};return v(n,r)},rectsOverlap:v,find:w,findOne:E,findWithin:O,findOneWithin:(e,t,n)=>n&&e.matches(t)?e:e.querySelector(t),succeeding:$,preceding:(e,t)=>{for(;e.previousElementSibling&&!e.previousElementSibling.matches(t);)e=e.previousElementSibling;return e.previousElementSibling},findAbove:(e,t,n,r)=>{let o=r?e:e.parentElement;const s=[];for(;o&&o!==document.body&&("string"!=typeof n||!o.matches(n))&&o!==n;)o.matches(t)&&s.push(o),o=o.parentElement;return s},id:_,text:x,fragment:j,create:A,classes:(e,t)=>{p(t,(t,n)=>{t?e.classList.add(n):e.classList.remove(n)})},styles:(e,t)=>{p(t,(t,n)=>{e.style[n]=t})},empty:e=>{for(;e.lastChild;)e.lastChild.remove()},elementIndex:e=>[...e.parentElement.children].indexOf(e),moveChildren:(e,t)=>{for(;e.firstChild;)t.appendChild(e.firstChild)},copyChildren:(e,t)=>{let n=e.firstChild;for(;n;)t.appendChild(n.cloneNode(!0)),n=n.nextSibling},wrap:(e,t,n)=>{try{const r=e.parentElement,o=n?t.querySelector(n):t;r.insertBefore(t,e),o.appendChild(e)}catch(e){throw new Error("wrap failed")}},unwrap:(e,t)=>{try{const n=t?e.closest(t):e.parentElement;n.parentElement.insertBefore(e,n),n.remove()}catch(e){throw new Error("unwrap failed")}},within:(e,t,n)=>{const r=e.getBoundingClientRect(),{clientX:o,clientY:s}=t;return o+n>r.left&&o-n<r.right&&s+n>r.top&&s-n<r.bottom},isInBody:e=>e&&document.body.contains(e),cssVar:(e,t)=>{if(void 0===t)return getComputedStyle(document.documentElement).getPropertyValue(e).trim();document.documentElement.style.setProperty(e,t)}});let T=null;const P=[],S=[];let k=()=>{};const I=()=>{if(T)return T.cancel(),T=null,P.splice(0);if(P.length)throw new Error("_updateList is not empty but no _updateFrame set");return!1},M=(e,t)=>{const n=e?P.find(t=>e.startsWith(t.path)):P.find(e=>!e.path&&e.source&&e.source===t);n?e&&(n.source=t):(T||(T=(e=>{let t=!1;const n=()=>{t||e(),t=!0};return requestAnimationFrame(n),setTimeout(n,20),{cancel:()=>{t=!0}}})(k)),P.push({path:e,source:t}))},N=e=>M(!1,e),L=[],B=async e=>{e=e.toLocaleLowerCase(),window.customElements.get(e)||L.includes(e)||(L.push(e),await window.customElements.whenDefined(e),w(e).forEach(e=>{delete e._b8rBoundValues,N(e)}))},D=e=>{if(!e.trim())throw new Error("empty binding");if(-1===e.indexOf("="))throw new Error(`binding "${e}" is missing = sign; probably need a source or target`);const[,t,n]=e.trim().match(/^([^=]*)=([^;]*)$/m).map(e=>e.trim()),r=t.split(",").map(t=>{var n=t.match(/(\w+)(\(([^)]+)\))?/);if(n)return n?{target:n[1],key:n[3]}:null;console.error("bad target",t,"in binding",e)});return n||console.error("binding does not specify source",e),{targets:r,path:n}},q=e=>e.match(/(([^,([]+\.?)|(\[[^\]]+\]\.?)|\([^)]+\))+/g),F=e=>{try{return e.dataset.bind.replace(/\n\s*(\w+)(\([^)]*\))?=/g,";$1$2=").split(";").filter(e=>!!e.trim()).map(D)}catch(t){return console.error(e,t),[]}},R=e=>{const t=!!e&&e.closest("[data-path],[data-list-instance]"),n=t?t.dataset.path||t.dataset.listInstance:"";return-1===[".","["].indexOf(n[0])?n:R(t.parentElement)+n},H=(e,t)=>{t&&(e=e.closest(`.${t}-component`));const n=e.closest("[data-component-id]");return n?n.dataset.componentId:null},J=(e,t,n)=>{const r=new RegExp(t,"g");O(e,`[data-bind*="${t}"],[data-list*="${t}"],[data-path*="${t}"]`).forEach(e=>{["data-bind","data-list","data-path"].forEach(t=>{const o=e.getAttribute(t);o&&e.setAttribute(t,o.replace(r,n))})})},W=(e,t)=>{O(e,"[data-bind]",!0).filter(e=>!e.closest("[data-list]")).forEach(e=>{const n=e.dataset.bind;n.indexOf("=.")>-1&&(e.dataset.bind=n.replace(/=\.([^;\s]+)/g,`=${t}.$1`).replace(/=\./g,`=${t}`)),n.indexOf("${.")>-1&&(e.dataset.bind=n.replace(/\$\{(\.[^}]+)\}/g,"${"+t+"$1}"))})};let V=()=>{throw new Error("playSavedMessages is not ready yet")};const K=e=>null===e?"null":Array.isArray(e)?"array":"number"==typeof e&&isNaN(e)?"NaN":"string"==typeof e&&e.startsWith("#")?e:typeof e,U=e=>"-∞"===e?-1/0:"∞"===e[0]?1/0:parseFloat(e),z=(e,t)=>{let n,r;if(void 0===e)return!0;try{[,n,r]=(e||"").match(/^([[(]-?[\d.∞]+)?,?(-?[\d.∞]+[\])])?$/)}catch(t){throw new Error(`bad range ${e}`)}if(n){const e=U(n.substr(1));if("("===n[0]){if(t<=e)return!1}else if(t<e)return!1}if(r){const e=U(r);if(r.endsWith(")")){if(t>=e)return!1}else if(t>e)return!1}return!0},Q={},Z=(e,t)=>{const[,n,r,,o]=e.match(/^#([?]?)([^\s]+)(\s(.*))?$/)||[];if(n&&(null===t||void 0===t))return!0;const s=K(t);switch(r){case"any":return null!==t&&void 0!==t;case"function":return"function"===s;case"number":return"number"===s&&z(o,t);case"int":return"number"===s&&t===Math.floor(t)&&z(o,t);case"enum":try{return o.split("|").map(JSON.parse).includes(t)}catch(e){throw new Error(`bad enum specification (${o}), expect JSON strings`)}case"regexp":return"string"===s&&(t=t,(Q[o=o]?Q[o]:Q[o]=new RegExp(o)).test(t));default:if(s!==r)throw new Error(`unrecognized type specifier ${e}`);return!0}};var G,X;const Y=e=>{const t=K(e);switch(t){case"array":return e.map(Y);case"object":{const t={};return Object.keys(e).forEach(n=>{t[n]=Y(e[n])}),t}default:return t}},ee=e=>JSON.stringify(Y(e)),te=(e,t,n=[],r="")=>{const o=K(e),s=K(t);if(o.startsWith("#")?Z(o,t):o===s)if("array"===o){const o=t.length;if(1===e.length&&o)for(let s=0;s<o;s++)te(e[0],t[s],n,`${r}[${s}]`);else if(e.length>1&&o)for(let s=0;s<o;s++){let o=!1;for(const n of e)if(0===te(n,t[s],[],"").length){o=!0;break}o||n.push(`${r}[${s}] had no matching type`)}}else"object"===o&&re(e,t,n,r);else n.push(`${r?r+" ":""}was ${(e=>"string"==typeof e?`"${e}"`:e)(t)}, expected ${o}`);return n},ne=(e,t)=>{const n=Array.isArray(t)?[...t]:t.replace(/\[[^\]]*\]/g,".*").split(".");if(null===e||void 0===e||0===n.length)return e;{const t=n.shift();return"*"===t?Array.isArray(e)?1===e.length?ne(e[0],n):ne(Object.assign({},...e),n):void 0:ne(e[t],n)}},re=(e,t,n=[],r="")=>{for(const o of Object.keys(e).sort())te(e[o],t[o],n,r+"."+o);return n};class oe{constructor({isParamFailure:e,expected:t,found:n,errors:r}){Object.assign(this,{isParamFailure:e,expected:t,found:n,errors:r})}toString(){const{isParamFailure:e,errors:t}=this;return`bad ${e?"parameter":"result"}, ${JSON.stringify(t)}`}}const se=(e,t)=>{for(let e=0;e<t.length;e++)if(t[e]instanceof oe)return t[e];const n=e.map((e,n)=>te(e,t[n]));return n.flat().length?n:[]},ae=(e,t,n)=>{const r=function(...r){const o=se(t,r);if(0===o.length){const t=e(...r),o=te(n,t);return 0===o.length?t:new oe({isParamFailure:!1,expected:n,found:t,errors:o})}return new oe({isParamFailure:!0,expected:t,found:r,errors:o})};return Object.assign(r,{paramTypes:t,resultType:n}),r},ie=ae(ae,["#function","#array","#?any"],"#function");var ce=Object.freeze({describe:K,specificTypeMatch:Z,describeType:Y,typeJSON:ee,typeJS:e=>ee(e).replace(/"(\w+)":/g,"$1:"),matchType:te,exampleAtPath:ne,TypeError:oe,matchParamTypes:se,typeSafe:ie});const le=[],de=[],ue=()=>{de.forEach(e=>e())},he=e=>{const t=le.indexOf(e);t>-1&&le.splice(t,1),ue()},pe=(e,t,n,r)=>new Promise(function(o,s){(r=r||{}).headers||(r.headers={});var a=new XMLHttpRequest;if(le.push(a),ue(),a.open(t||"GET",e,!0),a.onreadystatechange=(()=>{if(a.readyState===XMLHttpRequest.DONE)switch(Math.floor(a.status/100)){case 0:case 5:case 4:he(a),s(a);break;case 3:break;case 2:he(a),o(a.responseText)}}),"object"==typeof n){if("GET"===t)throw new Error("GET requests do not support request body data");n=JSON.stringify(n),r.headers["Content-Type"]="application/json; charset=utf-8"}for(var i in r.headers)a.setRequestHeader(i,r.headers[i]);a.send(n)});var fe=Object.freeze({ajax:pe,xml:(e,t,n,r)=>new Promise(function(o,s){pe(e,t,n,r).then(e=>{try{o((new DOMParser).parseFromString(e,"text/xml"))}catch(t){console.error("Failed to parse data",e,t),s(t,e)}},s)}),json:(e,t,n,r)=>new Promise(function(o,s){pe(e,t,n,r).then(e=>{try{o(JSON.parse(e||"null"))}catch(t){console.error("Failed to parse data",e,t),s(t,e)}},s)}),jsonp:(e,t,n,r)=>new Promise(function(o,s){pe(e,t,n,r).then(e=>{let t="null";try{t=JSON.parse(e)}catch(t){console.error("Failed to parse data",e,t),s(t,e)}o(t)},s)}),ajaxRequestsInFlight:()=>le,onRequest:e=>{-1===de.indexOf(e)&&de.push(e)},offRequest:e=>{const t=de.indexOf(e);t>-1&&de.splice(t,1)}});const me="undefined"==typeof window?()=>{return require("crypto").randomBytes(16)}:()=>{const e=new Uint8Array(16);return window.crypto.getRandomValues(e),e},ye=async function(){}.constructor;var ge=Object.freeze({AsyncFunction:ye,debounce:(e,t)=>{let n;return(...r)=>{n&&clearTimeout(n),n=setTimeout(()=>e(...r),t)}},throttle:(e,t)=>{let n=Date.now()-t;return(...r)=>{const o=Date.now();o-n>t&&(n=o,e(...r))}}});const be={},ve=[],we={},Ee={},Oe=(e,t,n)=>{const r=A("div");r.innerHTML=t||"";const o=`${n}-component`,s=!!e&&((e,t)=>{const n=!!e&&A("style");return n&&(n.type="text/css",n.dataset.title=t,n.appendChild(x(e)),document.head.appendChild(n)),n})(e.replace(/_component_/g,o),o);for(const e of O(r,'[class*="_component_"]'))e.setAttribute("class",e.getAttribute("class").replace(/_component_/g,o));return{style:s,view:r}},$e=function(e,{css:t,html:n,load:r,initialValue:o,type:s,instanceType:a}){const{style:i,view:c}=Oe(t,n,e),l={version:2,name:e,style:i,view:c,path:`inline-${e}`,initialValue:o,instanceType:a};return s&&(Ee[e]=s),r&&(l.load=((e,t,n,o,s,a,i,c,l,d)=>{r({component:e,b8r:t,find:n,findOne:o,register:a,get:i,set:c,on:l,touch:d})})),ve[e]&&clearInterval(ve[e]),w(`[data-component="${e}"]`).forEach(t=>{t.closest("[data-list]")||t.dataset.component!==e||M(!1,t)}),be[e]=l,l},_e=(e,t,n,r)=>{if("object"==typeof t&&void 0===n)return $e(e,t);let o,s,a,i=!1,c=!1;n||(n=(()=>{const e=me();e[8]=e[8]>>2|128,e[6]=e[6]>>4|64;let t=0;return"xxxx-xx-xx-xx-xxxxxx".replace(/x/g,()=>(3840|e[t++]).toString(16).slice(1))})()),3===(s=t.split(/<style>|<\/style>/)).length?[,i,a]=s:a=t,(s=a.split(/<script[^>\n]*>|<\/script>/)).length>=3?[o,c]=s:o=a;const{style:l,view:d}=Oe(i,o,e);let u=()=>console.error("component",e,"cannot load properly");c&&c.match(/require\s*\(/)&&!c.match(/electron-require/)&&(console.error(`in component "${e}" replace require with await import()`),c=!1);try{u=!!c&&new ye("component","b8r","find","findOne","data","register","get","set","on","touch",`${c}\n//# sourceURL=${e}(component)`)}catch(t){throw console.error("error creating load method for component",e,t,c),new Error(`component ${e} load method could not be created`)}const h={name:e,style:l,view:d,load:u,path:n.split("/").slice(0,-1).join("/")};return h.path,r&&(h._source=t),ve[e]&&clearInterval(ve[e]),be[e]&&(be[e].style&&be[e].style.remove(),console.warn("component %s has been redefined",e)),be[e]=h,w(`[data-component="${e}"]`).forEach(t=>{t.closest("[data-list]")||t.dataset.component!==e||M(!1,t)}),h},xe={},je={},Ae=[],Ce=/^\.?([^.[\](),])+(\.[^.[\](),]+|\[\d+\]|\[[^=[\](),]*=[^[\]()]+\])*$/,Te=e=>Ce.test(e);class Pe{constructor(e,t){if(this._orig_test=e,"string"==typeof e)this.test=(t=>"string"==typeof t&&t.startsWith(e));else if(e instanceof RegExp)this.test=e.test.bind(e);else{if(!(e instanceof Function))throw new Error("expect listener test to be a string, RegExp, or test function");this.test=e}if("string"==typeof t)this.callback=((...e)=>{Ie(t)?Re(t,...e):He(this)});else{if("function"!=typeof t)throw new Error("expect callback to be a path or function");this.callback=t}Ae.push(this)}}const Se=(e,t)=>{if("."===e[0]){if(!t)throw new Error("cannot evaluate relative path without element");e=R(t)+e}else if("_data_"===e.substr(0,6)){if(!t)throw new Error("cannot evaluate _data_ path without element");e=R(t)+e.substr(6)}else if("_component_"===e.substr(0,11)){if(!t)throw new Error("cannot evaluate _component_ path without element");e=H(t)+e.substr(11)}return e},ke=(e,t)=>{if(")"===e.substr(-1))return((e,t)=>{const[,n,r]=e.match(/([^(]+)\(([^)]+)\)/);return-1===r.indexOf(",")?Re(n,Ie(r,t)):Re(n,...Ie(r,t))})(e,t);if(e.startsWith(".")){const n=t.closest("[data-list-instance]");return n?d(n._b8rListInstance,e.substr(1)):void 0}if(e=Se(e,t),Te(e))return d(xe,e);console.error(`getting invalid path ${e}`)},Ie=(e,t)=>{const n=q(e);return 1===n.length?ke(n[0],t):n.map(e=>ke(e,t))},Me=(e,t)=>{Ae.filter(t=>t.test(e)).forEach(n=>n.callback(e,t))},Ne=(e,t)=>{console.error(`registry type check(s) failed after ${t}`,e)};let Le=Ne;const Be=(e,t)=>{const n=t.startsWith("c#")?Ee[t.split("#")[1]]:je[t];if(!n||!xe[t])return;const r=te(n,xe[t],[],t);r.length&&Le(r,t)},De=(e,t,n)=>{Te(e)||console.error(`setting invalid path ${e}`);const r=e.split(/\.|\[/),[o]=r,s=r[0],a=d(xe,e);if(r.length>1&&!xe[s])console.error(`cannot set ${e} to ${t}, ${s} does not exist`);else{if(1===r.length&&"object"!=typeof t)throw new Error(`cannot set ${e}; you can only register objects at root-level`);t===a?(Array.isArray(t)||Array.isArray(a))&&Me(e,n):t&&t.constructor?1!==r.length||xe[e]?(t.constructor===Object&&a&&a.constructor===Object?u(xe,e,Object.assign(t,Object.assign({},a,t))):u(xe,e,t),Me(e,n)):Fe(e,t):(u(xe,e,t),Me(e,n))}return Be(0,o),t},qe=(e,t)=>{xe[e]=t,Be(0,e)},Fe=(e,t,n)=>{if(e.match(/^_[^_]*_$/))throw new Error("cannot register object as "+e+", all names starting and ending with a single '_' are reserved.");qe(e,t),n||(Me(e),V(e))},Re=(e,...t)=>{const n=Ie(e);if(n instanceof Function)return n(...t);console.error(`cannot call ${e}; not a method`)},He=e=>{let t,n=!1;if(e instanceof Pe)(t=Ae.indexOf(e))>-1?Ae.splice(t,1):console.error("unobserve failed, listener not found");else if(e)for(let t=Ae.length-1;t>=0;t--)Ae[t]._orig_test===e&&(Ae.splice(t,1),n=!0);return n},Je=e=>!!xe[e.split(".")[0]],We=(t,n=!0)=>{null!==d(Ve=xe,t=t)&&u(Ve,t,e),n&&(Me(t),[,t]=t.match(/^(.+)\[[^\]]+\]$/)||[],t&&Me(t))};var Ve,Ke;const Ue=(e,t)=>Ie(t?e+("["===t[0]?t:"."+t):e);var ze=Object.freeze({onTypeError:e=>{Le=e},offTypeError:()=>{Le=Ne},get:Ie,getJSON:(e,t,n)=>{const r=Ie(e,t),o=[];return JSON.stringify(r,(e,t)=>t&&"object"==typeof t?"object"==typeof t?t.constructor!==Object&&t.constructor!==Array?`[${t.constructor.name}]`:-1===o.indexOf(t)?(o.push(t),t):"[duplicate or circular reference]":void 0:t,n?2:0)},getByPath:Ue,set:De,replace:(e,t)=>("object"==typeof t&&u(xe,e,null),De(e,t),t),setJSON:(e,t)=>De(e,JSON.parse(t)),increment:e=>De(e,Ie(e)+1),decrement:e=>De(e,Ie(e)-1),zero:e=>De(e,0),push:(e,t,n)=>{const r=Ie(e)||De(e,[]);Array.isArray(r)&&(r.push(t),n&&n(r),Me(e))},unshift:(e,t)=>{const n=Ie(e)||De(e,[]);Array.isArray(n)&&(n.unshift(t),Me(e))},sort:(e,t)=>{const n=Ie(e)||De(e,[]);Array.isArray(n)&&(n.sort(t),Me(e))},call:Re,callIf:(e,...t)=>{const n=Ie(e);return n instanceof Function?n(...t):null},touch:Me,observe:(e,t)=>new Pe(e,t),unobserve:He,models:()=>Object.keys(xe),_register:qe,registerType:(e,t)=>{je[e]=t,Be(0,e)},register:Fe,registered:Je,remove:We,deregister:e=>{console.warn("deregister is deprecated, use b8r.remove"),We(e)},resolvePath:Se,isValidPath:Te});const Qe={},Ze=new Image;Ze.src=(e=>{const t=document.createElement("canvas");t.width=1,t.height=1;const n=t.getContext("2d");return n.fillStyle=e||"rgba(255,255,255,0.3)",n.fillRect(0,0,1,1),t.toDataURL()})();const Ge=new Promise(e=>e(Ze)),Xe=(e,t,n=!0)=>{e instanceof HTMLImageElement&&e.src===t||(e.src=Ze.src,e.style.opacity=.1,((e,t=!0)=>e?Qe[e]?Qe[e]:(Qe[e]=new Promise(n=>{const r=new Image;t&&r.setAttribute("crossorigin","anonymous"),r.src=e,r.onload=(()=>{n(r)}),r.onerror=(()=>{n(Ze)})}),Qe[e]):Ge)(t,n).then(t=>{if(getComputedStyle(e).transition||(e.style.transition="0.25s ease-out"),e.style.opacity="",e.classList.add("-b8r-rendered"),e instanceof HTMLCanvasElement){e.width=e.offsetWidth,e.height=e.offsetHeight;const n=e.getContext("2d"),r=e.offsetWidth,o=e.offsetHeight,s=Math.max(r/t.width,o/t.height),a=r/s,i=o/s,c=.5*(t.width-a),l=.5*(t.height-i);n.drawImage(t,c,l,a,i,0,0,r,o)}else e.setAttribute("src",t.src)}))},Ye=document.createElement("div"),et=e=>{const t=[];return e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),e.shiftKey&&t.push("shift"),t.push((e=>{if(e.code)return e.code.replace(/Key|Digit/,"");{let t=e.keyIdentifier;return"U+"===t.substr(0,2)&&(t=String.fromCharCode(parseInt(e.keyIdentifier.substr(2),16))),t}})(e)),t.join("-")};var tt=["mousedown","mouseup","click","dblclick","mouseleave","mouseenter","mousemove","mouseover","mouseout","mousewheel","scroll","contextmenu","dragstart","dragenter","dragover","dragleave","dragend","drop","transitionend","animationend","input","change","keydown","keyup","cut","copy","paste","focus","blur"];const nt=e=>{var t,n,r,o,s=!1;if("object"==typeof e[2])return console.warn("b8r.on(element, type, OBJECT) is deprecated"),[t,n,r]=e,at(t,n,r.model,r.method);if(e.length>4||"string"==typeof e[3]){if([t,n,r,o,s]=e,"string"!=typeof r||"string"!=typeof o)return void console.error("implicit bindings are by name, not",r,o);o=r+"."+o}else[t,n,o,s]=e;if(!(t instanceof Element))throw console.error("bind bare elements please, not",t),new Error("bad argument");return{element:t,eventType:n,path:o,prepend:s}},rt=e=>{const t=e.dataset.event;return t?t.replace(/\s*(^|$|[,:;])\s*/g,"$1").split(/[;\n]/).filter(e=>e.trim()):[]},ot=e=>{const t=rt(e);try{return t.map(function(t){const[n,r]=t.split(":");if(!r)return t.indexOf(".")?console.error("bad event handler (missing event type)",t,"in",e):console.error("bad event handler (missing handler)",t,"in",e),{types:[]};const o=r.trim().match(/^([^.]+)\.(.+)$/);if(!o)throw new Error(`bad event handler "${r}"`);const[,s,a]=o,i=n.split(",").sort();return{types:i.map(e=>e.split("(")[0].trim()),typeArgs:i.map(e=>{"key"===e.substr(0,3)&&(e=(e=e.replace(/Key|Digit/g,"")).replace(/CmdOrCtrl/g,navigator.userAgent.indexOf("Macintosh")>-1?"meta":"ctrl"));var t=e.match(/\(([^)]+)\)/);return!(!t||!t[1])&&t[1].split(",")}),model:s,method:a}})}catch(e){return console.error("fatal error in event handler",e),[]}},st=(e,t)=>{if("string"==typeof e&&(e=[e]),Array.isArray(e))return e.sort().join(",")+":"+t;console.error("makeHandler failed; bad eventType",e)};function at(...e){const{element:t,eventType:n,path:r,prepend:o}=nt(e),s=st(n,r),a=rt(t);-1===a.indexOf(s)&&(o?a.unshift(s):a.push(s),t.dataset.event=a.join(";"))}function it(...e){var t,n,r,o;if(4===e.length)[t,n,r,o]=e,o=r+"."+o;else{if(3!==e.length)throw new Error("b8r.off requires three or four arguments");[t,n,o]=e}const s=t.dataset.event.split(";"),a=st(n,o),i=s.indexOf(a);i>-1&&(s.splice(i,1),s.length?t.dataset.event=s.join(";"):t.dataset.event&&delete t.dataset.event)}window.TouchEvent&&["touchstart","touchcancel","touchmove","touchend"].forEach(e=>tt.push(e));const ct=function(e,t){var n=!1;for(e=e.closest("[data-component-id]");e instanceof Element;){if(Ie(`${e.dataset.componentId}.${t}`)instanceof Function){n=e.dataset.componentId;break}e=e.parentElement.closest("[data-component-id]")}return n};var lt=[];V=(e=>{for(var t=[],n=lt.length-1;n>=0;n--)lt[n].model===e&&(t.push(lt[n]),lt.splice(n,1));for(;t.length;){var{model:r,method:o,args:s}=t.pop();dt(r,o,...s)}});const dt=(...e)=>{var t,r;try{e[0].match(/[[.]/)?([r,...e]=e,[t,r]=n(r)):[t,r,...e]=e}catch(e){}var o=null;return Je(t)?o=Re(`${t}.${r}`,...e):(t=t,r=r,e=e,lt.push({model:t,method:r,args:e})),o};var ut,ht,pt;const ft=e=>{for(var t=Ye,n=e.args||[],r=e instanceof KeyboardEvent?et(e):{};t;){for(var o=ot(t),s=!1,a=0;a<o.length;a++)for(var i=o[a],c=0;c<i.types.length;c++)if(i.types[c]===e.type&&(!i.typeArgs[c]||i.typeArgs[c].indexOf(r)>-1)){if(!i.model||!i.method){console.error("incomplete event handler on",t);break}if("_component_"===i.model&&(i.model=ct(t,i.method)),i.model?s=dt(i.model,i.method,e,t,...n):console.warn(`_component_.${i.method} not found`,t),!0!==s)return e.stopPropagation(),void e.preventDefault()}t=t===Ye?e.target.closest("[data-event]"):t.parentElement.closest("[data-event]")}},mt=(e,t,...n)=>{if("string"==typeof e&&(!t||t.dispatchEvent instanceof Function))if(t){const r=((e,t,...n)=>{const r=new Event(e);return r.args=n,t.dispatchEvent(r),r.target!==t?{type:e,target:t,args:n}:r})(e,t,...n);t instanceof Element&&-1===tt.indexOf(e)&&ft(r)}else console.warn("b8r.trigger called with no specified target");else console.error("expected trigger(eventType, target_element)",e,t)};var yt,gt,bt,vt,wt=(yt=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,gt=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,bt=/[^-+\dA-Z]/g,vt=function(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e},function(e,t,n){var r=wt;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(e)||/\d/.test(e)||(t=e,e=void 0),e=e?new Date(e):new Date,isNaN(e))throw SyntaxError("invalid date");"UTC:"==(t=String(r.masks[t]||t||r.masks.default)).slice(0,4)&&(t=t.slice(4),n=!0);var o=n?"getUTC":"get",s=e[o+"Date"](),a=e[o+"Day"](),i=e[o+"Month"](),c=e[o+"FullYear"](),l=e[o+"Hours"](),d=e[o+"Minutes"](),u=e[o+"Seconds"](),h=e[o+"Milliseconds"](),p=n?0:e.getTimezoneOffset(),f={d:s,dd:vt(s),ddd:r.i18n.dayNames[a],dddd:r.i18n.dayNames[a+7],m:i+1,mm:vt(i+1),mmm:r.i18n.monthNames[i],mmmm:r.i18n.monthNames[i+12],yy:String(c).slice(2),yyyy:c,h:l%12||12,hh:vt(l%12||12),H:l,HH:vt(l),M:d,MM:vt(d),s:u,ss:vt(u),l:vt(h,3),L:vt(h>99?Math.round(h/10):h),t:l<12?"a":"p",tt:l<12?"am":"pm",T:l<12?"A":"P",TT:l<12?"AM":"PM",Z:n?"UTC":(String(e).match(gt)||[""]).pop().replace(bt,""),o:(p>0?"-":"+")+vt(100*Math.floor(Math.abs(p)/60)+Math.abs(p)%60,4),S:["th","st","nd","rd"][s%10>3?0:(s%100-s%10!=10)*s%10]};return t.replace(yt,function(e){return e in f?f[e]:e.slice(1,e.length-1)})});wt.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},wt.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return wt(this,e,t)};var Et=Object.freeze({value:e=>{let t=e.dataset.pendingValue;if(t&&(t=JSON.parse(t),e.value=t,e.value===t&&e.dataset.pendingValue&&delete e.dataset.pendingValue),e.matches("input[type=radio]")){const t=e.getAttribute("name"),n=w(`input[type=radio][name=${t}]`).find(e=>e.checked);return n?n.value:null}return e.matches("[data-type=number],input[type=number],input[type=range]")?parseFloat(e.value):e.dataset.componentId?Ie(`${e.dataset.componentId}.value`):e.value},checked:e=>e.indeterminate?null:e.checked,selected:e=>e.selected,text:e=>e.textContent,currentTime:e=>e.currentTime,playbackRate:e=>e.playbackRate,prop:(e,t)=>e[t],component:(e,t)=>{const n=e.dataset.componentId;return Ue(n,t)},fromMethod:(e,t)=>{let[n,...r]=t.split(".");return r=r.join("."),Ue(n,r)(e)}});var Ot=Object.freeze({sortAscending:(e,t)=>"string"==typeof e||"string"==typeof t?`${e}`.localeCompare(t):e>t?1:t>e?-1:0,sortDescending:(e,t)=>"string"==typeof e||"string"==typeof t?`${t}`.localeCompare(e):e>t?-1:t>e?1:0});const $t=[],_t=e=>{for(var t=0;t<$t.length;t++)$t[t].targetElement===e&&delete $t[t].data},xt=e=>{var t,n,r,o;return 2===e.length?[t,o]=e:([t,n,r]=e,o=n+"."+r),{eventType:t,path:o}},jt=(e,{content:t=!1,attributes:n={},styles:r={},classes:o=[]})=>{const s=document.createElement(e);return Tt(s,t),Object.keys(n).forEach(e=>s.setAttribute(e,n[e])),Object.keys(r).forEach(e=>{s.style[e]=r[e]}),o.forEach(e=>s.classList.add(e)),s},At=(e={})=>jt("slot",e),Ct=e=>document.createTextNode(e),Tt=(e,t)=>{if(t)if("string"==typeof t)e.textContent=t;else if(Array.isArray(t))t.forEach(t=>{e.appendChild(t.cloneNode?t.cloneNode(!0):Ct(t))});else{if(!t.cloneNode)throw new Error("expect text content or document node");e.appendChild(t.cloneNode(!0))}},Pt=(e,t)=>{const n=new Event(t);e.dispatchEvent(n)};var St=Object.freeze({fragment:(...e)=>{const t=document.createDocumentFragment();return e.forEach(e=>t.appendChild(e.cloneNode(!0))),t},makeElement:jt,makeWebComponent:(e,{superClass:t=HTMLElement,value:n=!1,style:r=!1,methods:o={},eventHandlers:s={},props:a={},attributes:i={},content:c=At(),ariaRole:l=!1})=>{let d=null;r?(r=Object.assign({":host([hidden])":{display:"none !important"}},r),d=jt("style",{content:(e=>"object"==typeof e?Object.keys(e).map(t=>{const n=e[t];return`${t} {\n${Object.keys(n).map(e=>`  ${(e=>e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()))(e)}: ${n[e]};`).join("\n")}\n}`}).join("\n\n"):e)(r)})):r&&console.error(`style for a web-component ${e} with now shadowRoot is not supported`),o.render&&(o=Object.assign({queueRender(e=!1){this._changeQueued||(this._changeQueued=e),this._renderQueued||(this._renderQueued=!0,requestAnimationFrame(()=>{this._changeQueued&&Pt(this,"change"),this._changeQueued=!1,this._renderQueued=!1,this.render()}))}},o));const u=class extends t{constructor(){if(super(),Object.assign(this,a),d){const e=this.attachShadow({mode:"open"});e.appendChild(d.cloneNode(!0)),Tt(e,c)}else Tt(this,c);Object.keys(s).forEach(e=>{this.addEventListener(e,s[e].bind(this))}),l&&this.setAttribute("aria-role",l);const e=Object.keys(i);if(s.childListChange&&new MutationObserver(s.childListChange.bind(this)).observe(this,{childList:!0}),e.length){const t={};new MutationObserver(t=>{let n=!1,r=!1;t.forEach(t=>{n="value"===t.attributeChange,r=r||n||e.includes(t.attributeName)}),r&&this.queueRender&&this.queueRender(n)}).observe(this,{attributes:!0}),e.forEach(e=>{Object.defineProperty(this,e,{writeable:!0,enumerable:!1,get(){return"boolean"==typeof i[e]?this.hasAttribute(e):this.hasAttribute(e)?"number"==typeof i[e]?parseFloat(this.getAttribute(e)):this.getAttribute(e):void 0!==t[e]?t[e]:i[e]},set(n){"boolean"==typeof i[e]?n!==this[e]&&(n?this.setAttribute(e,""):this.removeAttribute(e),this.queueRender&&this.queueRender("value"===e)):"number"==typeof i[e]?n!==parseFloat(this[e])&&(this.setAttribute(e,n),this.queueRender&&this.queueRender("value"===e)):"object"!=typeof n&&`${n}`===`${this[e]}`||(null===n||void 0===n||"object"==typeof n?this.removeAttribute(e):this.setAttribute(e,n),t[e]=n,this.queueRender&&this.queueRender("value"===e))}})})}this.queueRender&&this.queueRender()}static defaultAttributes(){return{...i}}};return Object.keys(o).forEach(e=>{u.prototype[e]=o[e]}),window.customElements&&window.customElements.define(e,u),u},div:(e={})=>jt("div",e),slot:At,input:(e={})=>jt("input",e),button:(e={})=>jt("button",e),label:(e={})=>jt("label",e),span:(e={})=>jt("span",e),text:Ct,dispatch:Pt});const kt={};Object.assign(kt,C),Object.assign(kt,g),Object.assign(kt,{on:at,off:it,enable:(e,t)=>{(t?O(e,"[data-event-disabled]",!0):[e]).forEach(e=>{e.dataset.eventDisabled&&(e.dataset.event=e.dataset.eventDisabled,e.dataset.eventDisabled&&delete e.dataset.eventDisabled),e.disabled&&(e.disabled=!1)})},disable:(e,t)=>{(t?O(e,"[data-event]",!0):[e]).forEach(e=>{e.dataset.event&&(e.dataset.eventDisabled=e.dataset.event,e.dataset.event&&delete e.dataset.event),e.disabled||(e.disabled=!0)})},trigger:mt,callMethod:dt,implicitlyHandleEventsOfType:e=>{-1===tt.indexOf(e)&&(tt.push(e),document.body.addEventListener(e,ft,!0))}}),Object.assign(kt,{addDataBinding:(e,t,n)=>{const r=`${t}=${n=n.replace(/_component_/g,H(e))}`,o=(e.dataset.bind||"").split(";").map(e=>e.trim()).filter(e=>!!e);-1===o.indexOf(r)&&(o.push(r),e.dataset.bind=o.join(";"),delete e._b8rBoundValues,N(e))},removeDataBinding:(e,t,n)=>{const r=`${t}=${n}`;var o=(e.dataset.bind||"").split(";").map(e=>e.trim());o.indexOf(r)>-1&&((o=o.filter(e=>e!==r)).length?e.dataset.bind=o.join(";"):e.dataset.bind&&delete e.dataset.bind,delete e._b8rBoundValues)},getDataPath:R,getComponentId:H,getListPath:e=>{const t=e.closest("[data-list-instance]"),n=t&&$(t,"[data-list]");return n&&n.dataset.list.split(":")[0]},getListInstancePath:e=>{const t=e.closest("[data-list-instance]");return t?t.dataset.listInstance:null}}),Object.assign(kt,{onAny:function(...e){const{eventType:t,path:n}=xt(e);at(Ye,t,n)},offAny:function(...e){const{eventType:t,path:n}=xt(e);it(Ye,t,n)},anyListeners:()=>rt(Ye)}),Object.assign(kt,ze),Object.assign(kt,ce),kt.observe(()=>!0,(e,t)=>kt.touchByPath(e,t)),kt.keystroke=et,kt.modifierKeys={meta:"⌘",ctrl:"⌃",alt:"⌥",escape:"⎋",shift:"⇧"},kt.webComponents=St,Object.assign(kt,ge),kt.cleanupComponentInstances=kt.debounce(()=>{kt.forEachKey(Ht,(e,t)=>{kt.isInBody(e)&&e.dataset.componentId===t||delete Ht[t]}),kt.models().forEach(e=>{"c#"!==e.substr(0,2)||Ht[e]||(kt.callIf(`${e}.destroy`),kt.remove(e,!1))})},100),Object.assign(kt,{asyncUpdate:M,afterUpdate:e=>{P.length?-1===S.indexOf(e)&&S.push(e):e()},touchElement:N,touchByPath:(...e)=>{let t,n,r,o;e[1]instanceof HTMLElement?[t,n]=e:([r,o,n]=e,t=o&&"/"!==o?r+("["!==o[0]?".":"")+o:r),M(t,n)}}),kt.forceUpdate=(()=>{let e;for(;e=I();){const t=kt.find("[data-list]").map(e=>({elt:e,listBinding:e.dataset.list}));let n=!1;for(;e.length;){const{path:r,source:o}=e.shift();try{r?(t.filter(e=>e.elt!==o&&e.listBinding.includes(r)).forEach(({elt:e})=>Dt(e)),n||(n=kt.find("[data-bind]").map(e=>({elt:e,data_binding:e.dataset.bind}))),n.filter(e=>e.elt!==o&&e.data_binding.includes(r)).forEach(e=>{e.dirty=!0})):kt.bindAll(o)}catch(e){console.error("update error",e,{path:r,source:o})}}n&&n.forEach(({elt:e,dirty:t})=>t&&Nt(e))}kt.cleanupComponentInstances(),(()=>{for(;S.length;){let e;try{(e=S.shift())()}catch(t){console.error("_afterUpdate_callback error",t,e)}}})()}),(e=>{k=e})(kt.forceUpdate),kt.setByPath=function(...e){let t,r,o,s;if(2===e.length&&"object"==typeof e[1]&&!Array.isArray(e[1]))return[t,o]=e,void kt.forEachKey(o,(e,n)=>kt.setByPath(t,n,e));2===e.length||e[2]instanceof Element?([r,o,s]=e,r=kt.resolvePath(r,s),[t,r]=n(r)):[t,r,o,s]=e,kt.registered(t)?"object"==typeof r?kt.set(t,r,s):kt.set("["!==r[0]&&r?`${t}.${r}`:`${t}${r}`,o,s):console.error(`setByPath failed; ${t} is not a registered model`)},kt.pushByPath=function(...e){let t,r,o,s;if(2===e.length||"function"==typeof e[2]?([r,o,s]=e,[t,r]=n(r)):[t,r,o,s]=e,kt.registered(t)){const e=kt.get(r?`${t}.${r}`:t);e.push(o),s&&s(e),kt.touchByPath(t,r)}else console.error(`pushByPath failed; ${t} is not a registered model`)},kt.unshiftByPath=function(...e){let t,r,o;if(2===e.length?([r,o]=e,[t,r]=n(r)):[t,r,o]=e,kt.registered(t)){d(kt.get(t),r).unshift(o),kt.touchByPath(t,r)}else console.error(`unshiftByPath failed; ${t} is not a registered model`)},kt.removeListInstance=function(e){if(e=e.closest("[data-list-instance]")){const t=e.dataset.listInstance;try{const[,e,n,r]=t.match(/^([^.]+)\.(.+)\[([^\]]+)\]$/);kt.removeByPath(e,n,r)}catch(e){console.error("cannot find list item for instance",t)}}else console.error("cannot remove list instance for",e)},kt.removeByPath=function(...e){let t,r,o;if(2===e.length?([r,o]=e,[t,r]=n(r)):[t,r,o]=e,kt.registered(t)){const e=d(kt.get(t),r),n=function(e,t){if("number"==typeof t)return t;const[n,r]=t.split("=");return e.findIndex(e=>`${d(e,n)}`===r)}(e,o);Array.isArray(e)&&n>-1?e.splice(n,1):delete e[o],kt.touchByPath(t,r)}},kt.listItems=(e=>kt.makeArray(e.children).filter(e=>e.matches("[data-list-instance]"))),kt.listIndex=(e=>kt.listItems(e.parentElement).indexOf(e)),kt.getComponentData=((e,t)=>{const n=H(e,t);return n?kt.get(n):null}),kt.setComponentData=((e,t,n)=>{const r=H(e);kt.setByPath(r,t,n)}),kt.getData=(e=>{const t=kt.getDataPath(e);return t?kt.get(t,e):null}),kt.getListInstance=(e=>{const t=kt.getListInstancePath(e);return t?kt.get(t,e):null}),kt.getListTemplate=(e=>{e=e.closest("[data-list-instance]");do{e=e.nextElementSibling}while(!e.matches("[data-list]"));return e}),document.body?tt.forEach(e=>document.body.addEventListener(e,ft,!0)):document.addEventListener("DOMContentLoaded",()=>{tt.forEach(e=>document.body.addEventListener(e,ft,!0))});const It=function(e){const t={_true_:e=>!0===e,_false_:e=>!1===e,_undefined_:e=>void 0===e,_null_:e=>null===e,_empty_:e=>"string"==typeof e&&!!e.trim()},n=(e,n)=>("string"==typeof n&&(n=n.replace(/&nbsp;/g,"").trim()),Object.prototype.hasOwnProperty.call(t,e)?t[e](n):void 0!==e?n==e:!!n),r=e=>{if(!e)throw new Error("expected options");return e.split("|").map(e=>e.trim()).filter(e=>!!e).map(e=>1===(e=e.split(":").map(e=>e.trim())).length?{value:e[0]}:{match:e[0],value:e[1]})};return{value:function(t,n){switch("number"===t.dataset.type&&(n=parseFloat(n)),t.getAttribute("type")){case"radio":t.checked!==(t.value==n)&&(t.checked=t.value==n);break;case"checkbox":t.checked=n;break;default:t.dataset.componentId?e.set(`${t.dataset.componentId}.value`,n):void 0!==t.value?(t.value=n,t instanceof HTMLSelectElement&&(n&&!t.value?t.dataset.pendingValue=JSON.stringify(n):t.dataset.pendingValue&&delete t.dataset.pendingValue)):t.tagName.includes("-")||console.error("could not set component value",t,n)}},checked:(e,t)=>{null===t?(e.checked=!1,e.indeterminate=!0):e.checked=!!t},selected:(e,t)=>{e.selected=!!t},text:(e,t)=>{e.textContent=t},format:(t,n)=>{let r=n||"";if("string"!=typeof r)throw new Error("format only accepts strings or falsy values");let o=!1;r.match(/[*_]/)&&!r.match(/<|>/)&&(o=!0,r=r.replace(/[*_]{2,2}(.*?)[*_]{2,2}/g,"<b>$1</b>").replace(/[*_](.*?)[*_]/g,"<i>$1</i>")),r.indexOf("${")>-1&&(r=e.interpolate(r,t)),o?t.innerHTML=r:t.textContent=r},fixed:(e,t,n)=>{e.textContent=parseFloat(t).toFixed(n||1)},bytes:(e,t)=>{if(!t)return void(e.textContent="");const n=["B","kB","MB","GB","TB","PB","EB"];let r=n.shift();for(e.title=`${t} bytes`;t>1024&&r.length;)t=(t/1024).toFixed(1),r=n.shift();e.textContent=`${t} ${r}`},attr:function(e,t,n){void 0===t||null===t||!1===t?e.removeAttribute(n):e.setAttribute(n,t)},prop:function(e,t,n){e[n]=t},data:function(e,t,n){void 0===t||null===t||!1===t?delete e.dataset[n]:e.dataset[n]=t},img:Xe,bgImg:(e,t)=>{e.style.backgroundImage=t?`url("${t}")`:""},style:function(e,t,n){n?void 0!==t&&(e.style[n]=t):"string"==typeof t?e.setAttribute("style",n):"object"==typeof t&&Object.assign(e.style,t)},class:function(e,t,n){if(!n)throw new Error("class toTarget requires a class to be specified");const o=r(n);e.classList.toggle(o[0].value,!!t),o.length>1&&e.classList.toggle(o[1].value,!t)},class_unless:function(e,t,n){if(!n)throw new Error("class_unless toTarget requires a class to be specified");e.classList.toggle(n,!t)},class_map:function(e,t,o){let s=!1;r(o).forEach(r=>{s||r.match&&!n(r.match,t)?e.classList.remove(r.value):(e.classList.add(r.value),s=!0)})},contenteditable:function(e,t,r){n(r,t)?e.setAttribute("contenteditable",!0):e.removeAttribute("contenteditable")},enabled_if:function(t,r,o){n(o,r)?e.enable(t):e.disable(t)},disabled_if:function(t,r,o){n(o,r)?e.disable(t):e.enable(t)},pointer_events_if:function(e,t){e.style.pointerEvents=t?"auto":"none"},pointer_events_off_if:function(e,t){e.style.pointerEvents=t?"none":"auto"},show_if:function(t,r,o){n(o,r)?e.show(t):e.hide(t)},hide_if:function(t,r,o){n(o,r)?e.hide(t):e.show(t)},method:function(t,n,r){let[o,...s]=r.split(".");s=s.join("."),"_component_"===o&&(o=ct(t,s)),o?e.callMethod(o,s,t,n):t.closest("body")&&console.warn(`method ${s} not found in`,t)},timestamp:function(e,t,n){if(t)if(n){const r=new Date(t);e.textContent=r.format(n)}else{const n=new Date(t);e.textContent=n.toLocaleString()}else e.textContent=""},json:function(e,t){try{e.textContent=JSON.stringify(t,!1,2)}catch(n){const r={};Object.keys(t).forEach(e=>{r[e]=function e(t,n=4,r=!1){if(void 0===t)return"undefined";if(!Array.isArray(t)){if(t&&t.constructor===Object){const e=Object.keys(t);return n>=0&&e.length>n&&(e.splice(n),e.push("…")),`{${e.sort().join(",")}}`}if("string"==typeof t)return r?"string":`"${t}"`;if(t instanceof Function){const e=t.toString(),n=e.match(/^(async\s+)?(function[^(]*\()?\(?(.*?)(\)\s*\{|\)\s*=>|=>)/m)[3].trim(),r=e.match(/\[native code\]/),o=r?"[native code]":"...";let s=t.prototype||r?`function(${n}){${o}}`:`(${n})=>{${o}}`;return e.startsWith("async")&&(s="async "+s),s}return isNaN(t)?"NaN":"boolean"==typeof t?r?"bool":""+t:"number"==typeof t?r?"#":""+t:JSON.stringify(t)}return 0===t.length?"[]":1===t.length||typeof t[0]==typeof t[1]?`[${e(t[0],n,r)} × ${t.length}]`:typeof t[0]!=typeof t[1]?t.length<=n||n<0?"["+t.map(t=>e(t,n,r)).join(", ")+"]":`[* × ${t.length}]`:void 0}(t[e])}),e.textContent="/* partial data -- could not stringify */\n"+JSON.stringify(r,!1,2)}},data_path:function(t,n){(!t.dataset.path||n&&t.dataset.path.substr(-n.length)!==n)&&(t.dataset.path=n,e.bindAll(t))},component:function(t,n,r){const o=e.getComponentId(t);e.setByPath(o,r,n)},component_map:function(t,n,o){const s=r(o).find(e=>!e.match||e.match==n);if(s){const n=s.value;-1===(t.dataset.componentId||"").indexOf(`c#${n}#`)&&(e.removeComponent(t),e.insertComponent(n,t))}}}}(kt);kt.onAny(["change","input"],"_b8r_._update_"),kt.interpolate=((e,t)=>{let n;if(e.match(/\$\{[^{]*?\}/)){n=e;do{n=n.replace(/\$\{([^{]*?)\}/g,(e,n)=>{const r=kt.get(n,t);return null!==r?r:""})}while(n.match(/\$\{[^{]*?\}/))}else{const r=q(e);if(r.indexOf("")>-1)throw new Error(`empty path in binding ${e}`);1===(n=r.map(e=>kt.get(e,t))).length&&(n=n[0])}return n});const Mt=(e,t)=>e!==t||e&&"object"==typeof e;function Nt(e){if(e.tagName.includes("-")&&e.constructor===HTMLElement)return void B(e.tagName);if(e.closest("[data-component],[data-list]"))return;const t=F(e),n=e._b8rBoundValues||(e._b8rBoundValues={}),r={};for(let o=0;o<t.length;o++){const{targets:s,path:a}=t[o],i=kt.interpolate(a,e),c=n[a];if(Mt(c,i)){r[a]=i;const n=s.filter(e=>It[e.target]);n.length?n.forEach(t=>{It[t.target](e,i,t.key)}):console.warn("unrecognized toTarget in binding",e,t[o])}}Object.assign(n,r)}kt.show=((e,...t)=>{b(e)||(void 0===e.dataset.origDisplay&&(e.dataset.origDisplay="none"===e.style.display?"":e.style.display),e.style.display=e.dataset.origDisplay,O(e,'[data-event*="show"]',!0).forEach(e=>mt("show",e,...t)))}),kt.hide=((e,...t)=>{b(e)&&(void 0===e.dataset.origDisplay&&(e.dataset.origDisplay=e.style.display,O(e,'[data-event*="hide"]',!0).forEach(e=>mt("hide",e,...t))),e.style.display="none")});const Lt=(e,t,n)=>{if(Array.isArray(e))for(let r=e.length-1;r>=0;r--){const o=e[r];n(o,t?`${t}=${d(o,t)}`:r)}else if(e.constructor===Object){if(t)throw new Error("id-path is not supported for objects bound as lists");const r=Object.keys(e);for(let t=r.length-1;t>=0;t--){const o=r[t];n(e[o],`=${o}`)}}else if(null!==e)throw new Error("can only bind Array and Object instances as lists")};let Bt=0;function Dt(e,t){if(e.classList.add("-b8r-empty-list"),!e.parentElement||e.parentElement.closest("[data-component]")||e.parentElement.closest("[data-list]"))return;const[n,r]=e.dataset.list.split(":");let o,s,a;try{[,,o,a]=n.match(/^(([^()]*)\()?([^()]*)(\))?$/),a=a.split(","),s=a[0]}catch(e){console.error("bindList failed; bad source path",n)}t&&(s=t+s);const i=kt.resolvePath(s,e);if(i!==s){let t=s=i;o&&(a.shift(),a=[s,...a.map(t=>kt.resolvePath(t,e))],t=`${o}(${a.join(",")})`),e.dataset.list=r?`${t}:${r}`:t}let c=kt.get(s);if(!c)return;if(o&&!r)throw new Error(`data-list="${e.dataset.list}" -- computed list requires id-path`);if("_auto_"===r)for(let e=0;e<c.length;e++)c[e]._auto_||(c[e]._auto_=++Bt);if(o){if(!kt.get(o))return;if((()=>{try{const t=a.map(kt.get),n=kt.callMethod(o,...t,e);Array.isArray(c)&&n.length&&-1===c.indexOf(n[0])&&console.warn(`list filter ${o} returned a new object`+" (not from original list); this will break updates!"),c=n}catch(e){console.error(`bindList failed, ${o} threw error`,e)}})(),!c)throw new Error("could not compute list; async filtered list methods not supported (yet)")}kt.show(e);const l=e._b8rListInstances||{},d=e._b8rListInstances={},u=e.cloneNode(!0);u.classList.remove("-b8r-empty-list"),0===u.classList.length&&u.removeAttribute("class"),delete u.dataset.list,"OPTION"===e.tagName&&(e.setAttribute("disabled",""),e.textContent="",u.removeAttribute("disabled"));let h,p=e,f=!1;const m={};e.classList.toggle("-b8r-empty-list",!c.length),Lt(c,r,(t,n)=>{if(m[n])return void console.warn(`${n} not unique ${r} in ${e.dataset.list}`);m[n]=!0;const o=`${s}[${n}]`;void 0===(h=l[o])?(f=!0,(h=u.cloneNode(!0)).dataset.listInstance=o,h._b8rListInstance=t,e.parentElement.insertBefore(h,p),W(h,o),kt.bindAll(h)):(delete l[o],h.nextSibling!==p&&e.parentElement.insertBefore(h,p)),d[o]=h,p=h}),kt.forEachKey(l,e=>{f=!0,e.remove()}),f&&kt.trigger("change",e.parentElement),kt.hide(e)}var qt,Ft;kt.bindAll=((e,t)=>{e=e,t=t,kt.findWithin(e||document.body,"[data-component]",!0).forEach(e=>{if(!e.closest("[data-list]")&&!e.dataset.componentId){const n=e.dataset.component;kt.insertComponent(n,e,t)}}),(e=>O(e,"[data-bind]",!0))(e).forEach(e=>Nt(e)),(e=>O(e,"[data-list]",!0))(e).forEach(e=>Dt(e,t))}),(e=>{const t=e=>Et[e.target];e._register("_b8r_",{echo:e=>console.log(e)||!0,stopEvent:()=>{},_update_:n=>{let r=e.findAbove(n.target,"[data-bind]",null,!0);if("SELECT"===n.target.tagName){const t=e.findWithin(n.target,"option[data-bind]:not([data-list])");r=r.concat(t)}return r.filter(e=>!e.matches("[data-list]")).forEach(n=>{const r=F(n);for(let o=0;o<r.length;o++){const{targets:s,path:a}=r[o],i=t=>{const r=Et[t.target](n,t.key);void 0!==r&&(delete n._b8rBoundValues,e.setByPath(a,r,n))};s.filter(t).forEach(i)}}),!0}})})(kt),Object.assign(kt,fe),Object.assign(kt,Ot),kt.onRequest(()=>{kt.registered("b8rRequestInFlight")?kt.set("b8rRequestInFlight",kt.ajaxRequestsInFlight()):kt.register("b8rRequestInFlight",kt.ajaxRequestsInFlight())});Object.assign(kt,{component:(e,t,n=!1)=>{if(void 0===t&&(e=(t=e).split("/").pop().split(".").shift()),!we[e]||n){if(!t)throw new Error(`expected component ${e} to be defined`);t=(e=>{for(;e.match(/([^/]+\/\.\.\/)/);)e=e.replace(/([^/]+\/\.\.\/)/g,"");return e})(t),we[e]=new Promise(function(r,o){if(be[e]&&!n)r(be[e]);else{const s=t.match(/\.\w+$/)?t:`${t}.component.html`;pe(s).then(o=>r(_e(e,o,t,n))).catch(n=>{delete we[e],console.error(n,`failed to load component ${t}`),o(n)})}})}return we[e]},makeComponent:_e,makeComponentNoEval:$e}),kt.components=(()=>Object.keys(be)),kt._DEPRECATED_COMPONENTS_PASS_DOWN_DATA=!1;let Rt=0;const Ht={};return kt.insertComponent=async function(e,t,n){const r="string"==typeof n?n:kt.getDataPath(t);if(t){if(!kt.isInBody(t))return}else t=kt.create("div");if("string"==typeof e){if(!be[e])return ve[e]||(ve[e]=setTimeout(()=>console.error("component timed out: ",e),5e3)),n&&((e,t)=>{t&&(_t(e),$t.push({targetElement:e,data:t}))})(t,n),void(t.dataset.component=e);e=be[e]}t.dataset.component&&delete t.dataset.component,n&&!r||(n=((e,t)=>{for(var n,r=0;r<$t.length;r++)if($t[r].targetElement===e)return n=$t[r].data,_t(e),n;const o=e.dataset.json;return o?JSON.parse(o):t})(t)||(e=>{const t=["destroy"],n=kt._DEPRECATED_COMPONENTS_PASS_DOWN_DATA?"[data-path],[data-list-instance],[data-component-id]":"[data-path],[data-list-instance]",r=e.closest(n);if(r){const e=kt.get(r.dataset.componentId||kt.getDataPath(r));return kt.filterObject(e||{},(e,n)=>!t.includes(n)||"function"!=typeof e)}return null})(t)||{}),null===t.parentElement&&document.body.appendChild(t);const o=kt.fragment(),s="c#"+e.name+"#"+ ++Rt;if(e.view.children.length){t.dataset.componentId?t.querySelector("[data-children]")?kt.moveChildren(t.querySelector("[data-children]"),o):kt.empty(t):kt.moveChildren(t,o);const n=e.view.querySelector("[data-parent]")||e.view;kt.copyChildren(n,t),J(t,"_component_",s),r&&J(t,"_data_",r);const a=kt.findOneWithin(t,"[data-children]");o.firstChild&&a&&(kt.empty(a),kt.moveChildren(o,a))}t.dataset.componentId=s,Ht[s]=t,kt.makeArray(t.classList).forEach(e=>{"-component"===e.substr(-10)&&t.classList.remove(e)}),t.classList.add(e.name+"-component"),r&&(t.dataset.path=r);const a=e=>kt.register(s,e);if(n={...n,dataPath:r,...e.initialValue?kt.deepClone(e.initialValue):{},componentId:s},e.load){const r=e=>kt.getByPath(s,e),o=(...e)=>{kt.setByPath(s,...e),("value"===e[0]||Object.prototype.hasOwnProperty.call(e[0],"value"))&&kt.trigger("change",t)},i=(...e)=>kt.on(t,...e),c=e=>kt.touchByPath(s,e);kt.register(s,n,!0);try{await e.load(t,(e=>e?Object.assign({},kt,{_path:e,component:(...t)=>{const n=t[1]?1:0;let r=t[n];return-1===r.indexOf("://")&&(r=`${e}/${r}`,t[n]=r),kt.component(...t)}}):kt)(e.path),e=>kt.findWithin(t,e),e=>kt.findOneWithin(t,e),n,a,r,o,i,c,e)}catch(t){console.error("component",e.name,"failed to load",t)}}else kt.register(s,n,!0);kt.bindAll(t)},kt.Component=kt.webComponents.makeWebComponent("b8r-component",{attributes:{name:"",path:""},content:!1,methods:{connectedCallback(){const{path:e,name:t}=this;e&&(e.endsWith(".js")?import(e).then(0):kt.component(e)),!t&&e&&(this.name=e.split("/").pop().split(".").shift())},render(){this.name?kt.insertComponent(this.name,this):kt.removeComponent(this)}}}),kt.wrapWithComponent=((e,t,n,r)=>{const o=kt.create("div");return r&&kt.forEachKey(r,(e,t)=>o.setAttribute(t,e)),kt.wrap(t,o),kt.insertComponent(e,o,n),o}),kt.removeComponent=(e=>{e.dataset.componentId&&(delete e.dataset.componentId,kt.makeArray(e.classList).forEach(t=>{/-component$/.test(t)&&(e.classList.remove(t),kt.empty(e))}),kt.cleanupComponentInstances())}),kt.componentOnce=(async(...e)=>{const t=await kt.component(...e);kt.findOne(`[data-component-id*="${t.name}"]`)||await kt.insertComponent(t)}),kt}();
//# sourceMappingURL=dist/b8r.iife.min.js.map